<!DOCTYPE html>
<html>
  <head>
    <title>.giant[Solving .redfont[7] Visualisation Challenges]</title>
    <meta charset="utf-8">
    <meta name="author" content=".superhuge[ An Chu]" />
    <link href="libs/remark-css/default.css" rel="stylesheet" />
    <link rel="stylesheet" href="example.css" type="text/css" />
    <link rel="stylesheet" href="my_theme.css" type="text/css" />
  </head>
  <body>
    <textarea id="source">
class: center, middle, inverse, title-slide

# .giant[Solving .redfont[7] Visualisation Challenges]
## .giant[with ggplot2]
### .superhuge[<br>An Chu]
### .superhuge[<br>07/2018]

---




background-image: url(hex-ggplot2.png)
background-size: contain


---
class: inverse, center, middle

.h0[1 - Axis Scales &amp; Transformations]


---
class: middle

.giant[.greenfont[Scales] control the mapping from .greenfont[data] to
.greenfont[aesthetics]]

---
class: middle

.giant[You can generate many plots .greenfont[without knowing how scales work]]

---

.left-code[

```r
## position mapping
ggplot(mpg,
    aes(displ, hwy)
) + geom_point()
```

```r
x ==&gt; disp
y ==&gt; hwy
```
]

.right-plot[
&lt;img src="visualization_ggplot2_files/figure-html/plot1-out-1.svg" width="100%" style="display: block; margin: auto 0 auto auto;" /&gt;
]


---

# What actually happens:

```r
ggplot(mpg, aes(displ, hwy)) +
    geom_point() +
    scale_x_continuous() +
    scale_y_continuous()

## the mappings now are obivious:

disp ==&gt; scale_x_continuous()
hwy ==&gt; scale_y_continuous()

```

???

The use of + to “add” scales to a plot is a little misleading. When you + a
scale, you’re not actually adding it to the plot, but overriding the existing
scale.

---

# Axis scales &lt;= types of data

```r
## for continuous data
scale_x/y_continuous()

## for discrete data
scale_x/y_discrete()

## for date/datetime/time data
scale_x/y_date()
scale_x/y_datetime()
scale_x/y_time()
```


---

# Common options


```yaml
name   : name of scale

breaks : control the breaks in the axis

labels : labels of axis tick marks

limits : control x or y axis limits

trans  : axis transformations ('log2', 'log10', ...)
```

---

.left-code[

# Naming axis


```r
ggplot(mpg,
    aes(displ, hwy)
) + geom_point() +
  scale_x_continuous(
    name = "Engine displacement (L)"
  ) + 
  scale_y_continuous(
    name = "Highway MPG"
  )
```
]

.right-plot[
&lt;img src="visualization_ggplot2_files/figure-html/plot2-out-1.svg" width="100%" style="display: block; margin: auto 0 auto auto;" /&gt;
]

---

.left-code[

# Naming axis


```r
ggplot(mpg,
    aes(displ, hwy)
) + 
geom_point() +
labs(
x = "Engine displacement (L)",
y = "Highway MPG"
)
```
]

.right-plot[
&lt;img src="visualization_ggplot2_files/figure-html/plot3-out-1.svg" width="100%" style="display: block; margin: auto 0 auto auto;" /&gt;
]


---

.left-code[

# Setting axis breaks


```r
ggplot(mpg,
    aes(displ, hwy)
) + 
geom_point() +
scale_x_continuous(
breaks = seq(2, 7, 0.5)
)
```
]

.right-plot[
&lt;img src="visualization_ggplot2_files/figure-html/plot4-out-1.svg" width="100%" style="display: block; margin: auto 0 auto auto;" /&gt;
]

---

.left-code[

# Setting axis labels


```r
ggplot(mpg,
    aes(displ, hwy)
) + 
geom_point() +
scale_x_continuous(
breaks = seq(2, 7, 2),
labels = c("two", "four", "six")
)
```
]

.right-plot[
&lt;img src="visualization_ggplot2_files/figure-html/plot5-out-1.svg" width="100%" style="display: block; margin: auto 0 auto auto;" /&gt;
]

---

.left-code[

# Setting axis limits


```r
ggplot(mpg,
    aes(displ, hwy)
) + 
geom_point() +
scale_y_continuous(
limits = c(10, 40)
)
```
]

.right-plot[
&lt;img src="visualization_ggplot2_files/figure-html/plot6-out-1.svg" width="100%" style="display: block; margin: auto 0 auto auto;" /&gt;
]



---

.left-code[

# Setting axis limits


```r
ggplot(mpg,
    aes(displ, hwy)
) + 
geom_point() +
ylim(10, 40)
```

```r
# xlim()
```

]

.right-plot[
&lt;img src="visualization_ggplot2_files/figure-html/plot7-out-1.svg" width="100%" style="display: block; margin: auto 0 auto auto;" /&gt;
]

---

.left-code[

# Transformations


```r
ggplot(mpg,
    aes(displ, hwy)
) + 
geom_point() +
scale_y_continuous(
trans = "reverse"
)
```

```r
# Others:
# trans = "log10"
# trans = "log2"
# trans = "sqrt"
```


]

.right-plot[
&lt;img src="visualization_ggplot2_files/figure-html/plot8-out-1.svg" width="100%" style="display: block; margin: auto 0 auto auto;" /&gt;
]

---

.left-code[

# Transformations


```r
ggplot(mpg,
    aes(displ, hwy)
) + 
geom_point() +
scale_y_reverse()
```

```r
# Others:
# scale_y_log10()
# scale_y_log2()
# scale_y_sqrt()
```
]

.right-plot[
&lt;img src="visualization_ggplot2_files/figure-html/plot9-out-1.svg" width="100%" style="display: block; margin: auto 0 auto auto;" /&gt;
]


---
class: middle, center


.h0[Critique by redesign]

---
background-image: url(cpi.png)
background-size: contain


---

&lt;img src="visualization_ggplot2_files/figure-html/plot10-1.svg" width="65%" style="display: block; margin: auto;" /&gt;

---

# Solution


```r
ggplot(cpi, aes(year, cpi)) +
    geom_line(size = 1, color = "#40655e") +
    geom_point(size = 2, color = "#40655e") +
    labs(title = "CPI quý I/2017 tăng cao nhất trong 3 năm qua") +
    scale_x_continuous(name = NULL,
                       breaks = 2010:2017,
                       labels = c("Q1/2010", 
                                  paste0("'", 11:17))) +
    scale_y_continuous(name = NULL,
                       breaks = cpi$cpi,
                       labels = paste0(cpi$cpi, "%"))
```

---
background-image: url(health-bar-chart.png)
background-size: contain

---

&lt;img src="visualization_ggplot2_files/figure-html/plot11-1.svg" width="100%" style="display: block; margin: auto;" /&gt;



---

# Solution


```r
ggplot(health_index, aes(country, score)) +
    geom_col() +
    labs(x = NULL, y = NULL, title = "Truncated axis") +
    coord_flip(ylim = c(87, 94)) -&gt; none_zero_baseline

ggplot(health_index,
       aes(country, score)) +
    geom_col() +
    labs(x = NULL, y = NULL, title = "Full-scale axis") +
    coord_flip() -&gt; zero_baseline
```

---
class: middle

.center[![](fuel-price.png)]

---

&lt;img src="visualization_ggplot2_files/figure-html/plot12-1.svg" width="95%" style="display: block; margin: auto;" /&gt;



---

# Solution


```r
ggplot(gasoline_price, aes(date, price)) +
    geom_point() +
    geom_step() +
    labs(title = "Biểu đồ giá xăng") +
    scale_x_date(name = NULL,
                 breaks = gasoline_price$date) +
    scale_y_continuous(name = NULL,
                       breaks = seq(16500, 18000, 500),
                       labels = c("16,500", "17,000", 
                                  "17,500", "(VND)\n18,000"))
```


---
background-image: url(thue-moi-truong.jpg)
background-size: contain

---

.huge[Lie factor = Size-of-effect-shown-in-graphic / Size-of-effect-in-data]

&lt;img src="lie-factor.png" height="500" width="800" class="center"&gt;

---
class: middle, center

.enormous[Size of effect in graphic = (5.3 - 0.6) / 0.6 = 7.83]

.enormous[Size of effect in data = (27.5 - 18) / 18 = 0.52]

.enormous[Lie factor = 7.83 / 0.52 = 15]



---

&lt;img src="visualization_ggplot2_files/figure-html/plot13-1.svg" width="95%" style="display: block; margin: auto;" /&gt;


---
class: middle, center

.enormous[Size of effect in graphic = (10 - 4) / 4 = 1.5]

.enormous[Size of effect in data = (41.9 - 12.3) / 12.3 = 2.4]

.enormous[Lie factor = 1.5 / 2.4 = 0.6]


---

# Solution


```r
env_tax &lt;- env_tax %&gt;%
    gather(type, amount, -year)

ggplot(env_tax, aes(year, amount, color = type)) +
    geom_line() +
    geom_point() +
    labs(x = NULL, y = NULL,
         title = "Thu và Chi Thuế Bảo Vệ Môi Trường",
         subtitle = "Đơn vị: nghìn tỷ đồng",
         caption = "Nguồn dữ liệu: Vnexpress/Infographics")
```



---
class: inverse, center, middle


.h0[2 - Color Scales]


---

# Choosing color is hard

--

.huge[R has:]

--

- .huge[657 named colors (run: `colors()`)]

--

- .huge[7 default color sets (`rainbow()`, `heat.colors()`, `terrain.colors()`,
`topo.colors()`, `cm.colors()`, `gray.colors()`)]

--

- .huge[and a bunch of color packages (`viridis`, `RColorBrewer`,
`colorspace`, ...)]


---

# When choosing color:

&lt;br&gt;

&lt;br&gt;

&lt;br&gt;

&gt; .center[.h9[Above all, do no harm.]]

&gt; .right[.huge[Edward R. Tufte]]


---

# Think carefully what you are using color for


.huge[Fundamental use of color in visualization:]

- .huge[to label (color as noun)]

- .huge[to measure (color as quantity)]

- .huge[to represent and imitate reality (color as representation)]

- .huge[to decorate (color as beauty)]


---
background-image: url(remix-rosling.png)
background-size: contain

???

http://truth-and-beauty.net/projects/remixing-rosling


---

# Color scales

```r
## continuous colour scales
scale_color/fill_continuous()

## evenly spaced colours for discrete data
scale_color/fill_hue()

## gradient colour scales
scale_color/fill_gradient()
scale_color/fill_gradient2()
scale_color/fill_gradientn()

## sequential grey colour scales
scale_color/fill_grey()
```

---

# Color scales

```r
## color for map from colorbrewer.org
scale_color/fill_brewer()
scale_color/fill_distiller()

## viridis colour scales from viridisLite
scale_color/fill_viridis_d()
scale_color/fill_viridis_c()

## pick your own colors
scale_color/fill_manual()
```


---





---
background-image: url(gii-color.png)
background-size: contain

???

https://infographics.vn/chi-so-doi-moi-sang-tao-cua-viet-nam-tiep-tuc-tang/10590.vna


---
background-image: url(pci.png)
background-size: contain


---

.enormous[Color scales - example 3]


---

.enormous[Color scales - Your turn 1]


---

.enormous[Color scales - Your turn 2]



---
class: inverse, center, middle


.h0[3 - Positions]

---
class: inverse, center, middle


.h0[4 - Legends]





---

# Your turn



---

# Solution



---
class: inverse, center, middle


.h0[5 - Fonts]


---
class: inverse, center, middle

.h0[6 - Themes]

---

# Built-in themes

```r
theme_gray() # default
theme_bw()
theme_linedraw()
theme_light()
theme_dark()
theme_minimal()
theme_classic()
theme_void()
theme_test() 
```

---

.left-code[

```r
p &lt;- ggplot(
  mpg, aes(displ, hwy)
) + geom_point()

p + theme_gray()
```

]

.right-plot[
&lt;img src="visualization_ggplot2_files/figure-html/plot60-out-1.svg" width="100%" style="display: block; margin: auto 0 auto auto;" /&gt;
]

---

.left-code[

```r
p &lt;- ggplot(
  mpg, aes(displ, hwy)
) + geom_point()

p + theme_minimal()
```

]

.right-plot[
&lt;img src="visualization_ggplot2_files/figure-html/plot61-out-1.svg" width="100%" style="display: block; margin: auto 0 auto auto;" /&gt;
]

---

.left-code[

```r
p &lt;- ggplot(
  mpg, aes(displ, hwy)
) + geom_point()

p + theme_bw()
```

]

.right-plot[
&lt;img src="visualization_ggplot2_files/figure-html/plot62-out-1.svg" width="100%" style="display: block; margin: auto 0 auto auto;" /&gt;
]


---

.left-code[

```r
p &lt;- ggplot(
  mpg, aes(displ, hwy)
) + geom_point()

p + theme_classic()
```

]

.right-plot[
&lt;img src="visualization_ggplot2_files/figure-html/plot63-out-1.svg" width="100%" style="display: block; margin: auto 0 auto auto;" /&gt;
]

---

# Modify components of a theme


```r
theme() # there's a ton of components
```


```r
theme(line, rect, text, title, aspect.ratio, axis.title, axis.title.x,
  axis.title.x.top, axis.title.x.bottom, axis.title.y, axis.title.y.left,
  axis.title.y.right, axis.text, axis.text.x, axis.text.x.top,
  axis.text.x.bottom, axis.text.y, axis.text.y.left, axis.text.y.right,
  axis.ticks, axis.ticks.x, axis.ticks.x.top, axis.ticks.x.bottom, axis.ticks.y,
  axis.ticks.y.left, axis.ticks.y.right, axis.ticks.length, axis.line,
  axis.line.x, axis.line.x.top, axis.line.x.bottom, axis.line.y,
  axis.line.y.left, axis.line.y.right, legend.background, legend.margin,
  legend.spacing, legend.spacing.x, legend.spacing.y, legend.key,
  legend.key.size, legend.key.height, legend.key.width, legend.text,
  legend.text.align, legend.title, legend.title.align, legend.position,
  legend.direction, legend.justification, legend.box, legend.box.just,
  legend.box.margin, legend.box.background, legend.box.spacing,
  panel.background, panel.border, panel.spacing, panel.spacing.x,
  panel.spacing.y, panel.grid, panel.grid.major, panel.grid.minor,
  panel.grid.major.x, panel.grid.major.y, panel.grid.minor.x,
  panel.grid.minor.y, panel.ontop, plot.background, plot.title, plot.subtitle,
  plot.caption, plot.tag, plot.tag.position, plot.margin, strip.background,
  strip.background.x, strip.background.y, strip.placement, strip.text,
  strip.text.x, strip.text.y, strip.switch.pad.grid, strip.switch.pad.wrap, ...,
  complete = FALSE, validate = TRUE)
```





---
class: inverse, center, middle

.h0[7 - Layout]
    </textarea>
<script src="https://remarkjs.com/downloads/remark-latest.min.js"></script>
<script>var slideshow = remark.create({
"ratio": "16:9",
"highlightStyle": "github",
"highlightLines": true,
"countIncrementalSlides": false
});
if (window.HTMLWidgets) slideshow.on('afterShowSlide', function (slide) {
  window.dispatchEvent(new Event('resize'));
});
(function() {
  var d = document, s = d.createElement("style"), r = d.querySelector(".remark-slide-scaler");
  if (!r) return;
  s.type = "text/css"; s.innerHTML = "@page {size: " + r.style.width + " " + r.style.height +"; }";
  d.head.appendChild(s);
})();</script>

<script>
(function() {
  var i, text, code, codes = document.getElementsByTagName('code');
  for (i = 0; i < codes.length;) {
    code = codes[i];
    if (code.parentNode.tagName !== 'PRE' && code.childElementCount === 0) {
      text = code.textContent;
      if (/^\\\((.|\s)+\\\)$/.test(text) || /^\\\[(.|\s)+\\\]$/.test(text) ||
          /^\$\$(.|\s)+\$\$$/.test(text) ||
          /^\\begin\{([^}]+)\}(.|\s)+\\end\{[^}]+\}$/.test(text)) {
        code.outerHTML = code.innerHTML;  // remove <code></code>
        continue;
      }
    }
    i++;
  }
})();
</script>
<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
(function () {
  var script = document.createElement('script');
  script.type = 'text/javascript';
  script.src  = 'https://cdn.bootcss.com/mathjax/2.7.1/MathJax.js?config=TeX-MML-AM_CHTML';
  if (location.protocol !== 'file:' && /^https?:/.test(script.src))
    script.src  = script.src.replace(/^https?:/, '');
  document.getElementsByTagName('head')[0].appendChild(script);
})();
</script>
  </body>
</html>
